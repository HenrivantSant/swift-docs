(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{141:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return y}));var i=n(0),r=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=i,y=d["".concat(s,".").concat(u)]||d[u]||b[u]||a;return n?r.a.createElement(y,o(o({ref:t},c),{},{components:n})):r.a.createElement(y,o({ref:t},c))}));function y(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,s=new Array(a);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var c=2;c<a;c++)s[c]=n[c];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},90:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var i=n(3),r=n(7),a=(n(0),n(141)),s={title:"Relations"},o={unversionedId:"database/relations",id:"database/relations",isDocsHomePage:!1,title:"Relations",description:"HasOne",source:"@site/docs/database/relations.md",slug:"/database/relations",permalink:"/swift-docs/docs/database/relations",editUrl:"https://github.com/SwiftAPI/swift-docs/tree/main/docs/database/relations.md",version:"current",sidebar:"docs",previous:{title:"Entities",permalink:"/swift-docs/docs/database/entities"},next:{title:"Entity Behaviors",permalink:"/swift-docs/docs/database/entity-behaviors"}},l=[{value:"HasOne",id:"hasone",children:[]},{value:"HasMany",id:"hasmany",children:[]},{value:"BelongsTo",id:"belongsto",children:[]},{value:"RefersTo",id:"refersto",children:[]},{value:"ManyToMany",id:"manytomany",children:[]},{value:"Embedding Entities",id:"embedding-entities",children:[{value:"Definition",id:"definition",children:[]}]},{value:"Collections",id:"collections",children:[]}],c={toc:l};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"hasone"},"HasOne"),Object(a.b)("p",null,"The Has One relation defines that an entity exclusively owns another entity in a form of parent-child. Consider this relation as a form of decomposition with the ability to store data in external table."),Object(a.b)("p",null,"The HasOne relation is used to define the relation to one child object. This object will be automatically be saved with its parent. The simplest form of relation definition."),Object(a.b)("p",null,"To define a HasOne relation, use the ",Object(a.b)("inlineCode",{parentName:"p"},"HasOne")," attribute."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Relation\\HasOne;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\n\n#[Entity( table: 'user' )]\nclass User extends AbstractEntity {\n\n    #[HasOne( targetEntity: Address::class, nullable: true )]\n    protected ?Address $address;\n    \n}\n")),Object(a.b)("h2",{id:"hasmany"},"HasMany"),Object(a.b)("p",null,"The Has Many relations defines that an entity exclusively owns multiple other entities in a form of parent-children."),Object(a.b)("p",null,"To define a Has Many relation use:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Relation\\HasOne;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\nuse Swift\\Orm\\Mapping\\Definition\\Relation\\EntityRelationType;\n\n#[Entity( table: 'movies' )]\nclass Movie extends AbstractEntity {\n\n    #[HasOne( targetEntity: Address::class, nullable: true )]\n    protected ?Address $address;\n    \n    #[HasMany( targetEntity: Review::class, inverse: new Inverse( as: 'movie', type: EntityRelationType::BELONGS_TO ) )]\n    protected ArrayCollectionInterface $reviews;\n    \n    /**\n     * @return \\Swift\\Orm\\Collection\\ArrayCollectionInterface\n     */\n    public function getReviews(): ArrayCollectionInterface {\n        return $this->reviews;\n    }\n    \n    /**\n     * @param \\App\\Foo\\Repository\\Review $review\n     */\n    public function addReview( Review $review ): void {\n        $review->setMovie( $this );\n        $this->reviews[] = $review;\n    }\n    \n}\n")),Object(a.b)("h2",{id:"belongsto"},"BelongsTo"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Belongs To")," relation defines that an entity is owned by a related entity on the exclusive matter.  "),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Example"),": a post belongs to an author, a comment belongs a post. Most ",Object(a.b)("inlineCode",{parentName:"p"},"belongsTo")," relations can be created using the ",Object(a.b)("inlineCode",{parentName:"p"},"inverse")," option of the declared ",Object(a.b)("inlineCode",{parentName:"p"},"hasOne")," or ",Object(a.b)("inlineCode",{parentName:"p"},"hasMany")," relation."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"The entity will always be persisted after its related entity.")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare(strict_types=1);\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Attributes\\Relation\\BelongsTo;\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\nuse Swift\\Security\\User\\Entity\\UserEntity;\n\n#[Entity(table: 'movie_reviews')]\nclass Review extends AbstractEntity {\n    \n    #[BelongsTo( targetEntity: UserEntity::class, inverseAs: 'movie_reviews' )]\n    protected ?UserEntity $user;\n\n}\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"You must properly handle the cases when the related entity is ",Object(a.b)("inlineCode",{parentName:"p"},"null"),".")),Object(a.b)("p",null,"By default, the ORM will generate an outer key in the relation object using the related entity's table and outer key ( primary key by default) values. As result column and FK will be added to Review entity on user_id column."),Object(a.b)("h2",{id:"refersto"},"RefersTo"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"RefersTo")," relation is similar to the ",Object(a.b)("inlineCode",{parentName:"p"},"BelongsTo")," relation, but must be used to establish multiple relations to the same entity (or in case of a cyclic relation)."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Relation\\HasMany;\nuse Swift\\Orm\\Attributes\\Relation\\RefersTo;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\nuse Swift\\Orm\\Mapping\\Definition\\Relation\\EntityRelationType;\n\n#[Entity( table: 'movies' )]\nclass Movie extends AbstractEntity {\n\n    #[RefersTo(targetEntity: Review::class)]\n    private ?Review $lastReview;;\n    \n    #[HasMany( targetEntity: Review::class, inverse: new Inverse( as: 'movie', type: EntityRelationType::BELONGS_TO ) )]\n    protected ArrayCollectionInterface $reviews;\n    \n    /**\n     * @return \\Swift\\Orm\\Collection\\ArrayCollectionInterface\n     */\n    public function getReviews(): ArrayCollectionInterface {\n        return $this->reviews;\n    }\n    \n    /**\n     * @param \\App\\Foo\\Repository\\Review $review\n     */\n    public function addReview( Review $review ): void {\n        $review->setMovie( $this );\n        $this->reviews[] = $review;\n    }\n    \n}\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"You must properly handle the cases when the related entity is ",Object(a.b)("inlineCode",{parentName:"p"},"null"),".")),Object(a.b)("p",null,"By default, the ORM will generate an outer key in the relation object using the related entity's table and outer key ( primary key by default) values. As result column and FK will be added to Review entity on user_id column."),Object(a.b)("h2",{id:"manytomany"},"ManyToMany"),Object(a.b)("p",null,"A relation of type 'Many To Many' provides a more complex connection. This relation will create a junction table to store the relation. This table will be generated automatically."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Relation\\ManyToMany;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\nuse Swift\\Orm\\Mapping\\Definition\\Relation\\EntityRelationType;\n\n#[Entity( table: 'movies' )]\nclass Movie extends AbstractEntity {\n\n    #[ManyToMany( targetEntity: Actor::class )]\n    protected ArrayCollectionInterface $actors;\n    \n}\n")),Object(a.b)("p",null,"Optionally you add the movies to the actors entity. There are no attributes necessary, as the relation is already defined in the ",Object(a.b)("inlineCode",{parentName:"p"},"movie")," entity."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Collection\\ArrayCollection;\n\n#[Entity( table: 'movie_actors' )]\nclass Actor extends AbstractEntity {\n    \n    protected ArrayCollection $movies;\n    \n    public function __construct() {\n        $this->movies = new ArrayCollection();\n    }\n    \n}\n")),Object(a.b)("h2",{id:"embedding-entities"},"Embedding Entities"),Object(a.b)("p",null,"The ORM can simplify the definition of large entities by providing the ability to split some columns into an embedded entity. Embedded entities by default will always be loaded with the parent object. However, partial entity selection is possible as well."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Embedded entities do not support relations at the moment.")),Object(a.b)("h3",{id:"definition"},"Definition"),Object(a.b)("p",null,"To define an embeddable entity use the ",Object(a.b)("inlineCode",{parentName:"p"},"#[Embeddable]")," (Swift\\Orm\\Attributes\\Embeddable) attribute. As with ",Object(a.b)("inlineCode",{parentName:"p"},"#[Entity]"),"."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Embeddable;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\n\n#[Embeddable]\nclass Address extends AbstractEntity {\n    \n    #[Field( name: 'country', type: FieldTypes::TEXT )]\n    protected string $country;\n    \n    #[Field( name: 'city', type: FieldTypes::TEXT, length: 32 )]\n    protected string $city;\n    \n    #[Field( name: 'address', type: FieldTypes::TEXT )]\n    protected string $address;\n    \n}\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"You do not need to define the primary column, this column will be inherited from the parent entity.")),Object(a.b)("p",null,"To embed an entity use the ",Object(a.b)("inlineCode",{parentName:"p"},"#[Embedded]")," (Swift\\Orm\\Attributes\\Embedded) attribute. Do not forget to initiate the embedding in your entity (see constructor)."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Attributes\\Relation\\Embedded;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\n\n#[Entity( table: 'user' )]\nclass User extends AbstractEntity {\n    \n    #[Field( name: 'id', primary: true, type: FieldTypes::INT, length: 11 )]\n    protected int $id;\n    \n    #[Embedded( target: Address::class )]\n    protected Address $address;\n    \n    public function __construct() {\n        $this->address = new Address();\n    }\n    \n}\n")),Object(a.b)("h4",{id:"column-mapping"},"Column mapping"),Object(a.b)("p",null,"By default, all embedded entity columns will be stored in the owning entity table without any prefix. If desired, you can use the ",Object(a.b)("inlineCode",{parentName:"p"},"#[Embedded( prefix: 'foo' )]")," attribute to add a prefix."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Relation\\Embeddable;\nuse Swift\\Orm\\Attributes\\Field;\nuse Swift\\Orm\\Types\\FieldTypes;\n\n#[Embeddable( prefix: 'address_' )]\nclass Address extends AbstractEntity {\n    \n    #[Field( name: 'country', type: FieldTypes::TEXT )]\n    protected string $country;\n    \n    #[Field( name: 'city', type: FieldTypes::TEXT, length: 32 )]\n    protected string $city;\n    \n    #[Field( name: 'address', type: FieldTypes::TEXT )]\n    protected string $address;\n    \n}\n")),Object(a.b)("h2",{id:"collections"},"Collections"),Object(a.b)("p",null,"Collections are an ArrayIterator implementation that provides a simple interface to iterate over a collection of entities and add some additional functionality. Collections represent a list of entities. Those are used for *Many relations."),Object(a.b)("p",null,"This is a concept that is heavily inspired by ",Object(a.b)("a",{parentName:"p",href:"https://www.doctrine-project.org/projects/doctrine-collections/en/latest/index.html"},"Doctrine Collections"),"."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace App\\Foo\\Repository;\n\nuse Swift\\Orm\\Entity\\AbstractEntity;\nuse Swift\\Orm\\Attributes\\Entity;\nuse Swift\\Orm\\Collection\\ArrayCollection;\n\n#[Entity( table: 'movie_actors' )]\nclass Actor extends AbstractEntity {\n    \n    protected ArrayCollection $movies;\n    \n    public function __construct() {\n        $this->movies = new ArrayCollection();\n    }\n    \n}\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Note that collections should always be initiated in the constructor of the entity.")))}p.isMDXComponent=!0}}]);