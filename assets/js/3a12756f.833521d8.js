(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{121:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return b}));var r=t(0),i=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var u=i.a.createContext({}),l=function(e){var n=i.a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d=function(e){var n=l(e.components);return i.a.createElement(u.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},v=i.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,a=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(t),v=r,b=d["".concat(a,".").concat(v)]||d[v]||p[v]||o;return t?i.a.createElement(b,s(s({ref:n},u),{},{components:t})):i.a.createElement(b,s({ref:n},u))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=v;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var u=2;u<o;u++)a[u]=t[u];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,t)}v.displayName="MDXCreateElement"},89:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return s})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return l}));var r=t(3),i=t(7),o=(t(0),t(121)),a={title:"Events, Subscribers & Listeners"},s={unversionedId:"events-and-subscribers",id:"events-and-subscribers",isDocsHomePage:!1,title:"Events, Subscribers & Listeners",description:"Under the hood the Symfony Event Dispatcher is used, however there is a custom implementation on the Event Dispatcher. This is in order to provide future stability and to enable the system for adding functionality in to the event system.",source:"@site/docs/events-and-subscribers.md",slug:"/events-and-subscribers",permalink:"/swift-docs/docs/events-and-subscribers",editUrl:"https://github.com/SwiftAPI/swift-docs/tree/master/docs/events-and-subscribers.md",version:"current",sidebar:"docs",previous:{title:"Dependency Injection",permalink:"/swift-docs/docs/dependency-injection"},next:{title:"GraphQL",permalink:"/swift-docs/docs/graphql"}},c=[{value:"Subscriber or listening to events",id:"subscriber-or-listening-to-events",children:[{value:"Subscribing to events",id:"subscribing-to-events",children:[]},{value:"Listening to an event",id:"listening-to-an-event",children:[]}]},{value:"How to create your own events",id:"how-to-create-your-own-events",children:[]},{value:"Dispatching events",id:"dispatching-events",children:[]},{value:"Default system events",id:"default-system-events",children:[]}],u={toc:c};function l(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},u,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Under the hood the ",Object(o.b)("a",{parentName:"p",href:"https://symfony.com/doc/current/components/event_dispatcher.html"},"Symfony Event Dispatcher")," is used, however there is a custom implementation on the Event Dispatcher. This is in order to provide future stability and to enable the system for adding functionality in to the event system."),Object(o.b)("h2",{id:"subscriber-or-listening-to-events"},"Subscriber or listening to events"),Object(o.b)("p",null,"You can choose to subscribe to (multiple) events by using an EventSubscriber. An EventSubscriber has to return an array of the events it desires to listen to. An EventListener on the other hand can mark a public method as a Listener for a specific event by annotating it with the ListenTo attribute (example below)."),Object(o.b)("h3",{id:"subscribing-to-events"},"Subscribing to events"),Object(o.b)("p",null,"When you want to do something when a given event occurs (like logging, or for example add a Route variable_type) you can subscribe to those events using a EventSubscriber instance. In contrary to Symfony, in this system Event Subscriber do support Dependency Injection. It is recommended to only use subscribers to 'catch' the event and use a service to execute the actual logic (and if applicable apply the result to the event). Quite the same as you would do in a Controller or a command. This makes the logic in the service reusable for different occasions and keeps the subscriber clean."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"namespace Foo\\EventSubscriber;\n\nuse Henri\\Framework\\Configuration\\Configuration;\nuse Henri\\Framework\\Events\\EventDispatcher;\nuse Swift\\Events\\EventSubscriberInterface;\nuse Swift\\Router\\Event\\OnBeforeRouteEnterEvent;\n\nfinal class FooSubscriber implements EventSubscriberInterface {\n\n    /**\n     * @var Configuration $configuration\n     */\n    private $configuration;\n\n    /**\n     * FooSubscriber constructor.\n     *\n     * @param Configuration $configuration\n     */\n    public function __construct( Configuration $configuration ) {\n        $this->configuration = $configuration;\n    }\n\n\n    /**\n     * Returns an array of event names this subscriber wants to listen to.\n     *\n     * The array keys are event names and the value can be:\n     *\n     *  * The method name to call (priority defaults to 0)\n     *  * An array composed of the method name to call and the priority\n     *  * An array of arrays composed of the method names to call and respective\n     *    priorities, or 0 if unset\n     *\n     * For instance:\n     *\n     *  * ['eventName' => 'methodName']\n     *  * ['eventName' => ['methodName', $priority]]\n     *  * ['eventName' => [['methodName1', $priority], ['methodName2']]]\n     *\n     * @return array The event names to listen to\n     */\n    public static function getSubscribedEvents(): array {\n        return array(\n            OnBeforeRouteEnterEvent::class => 'onBeforeRouteEnter',\n        );\n    }\n\n    /**\n     * @param OnBeforeRouteEnterEvent $event\n     * @param string $eventClassName\n     * @param EventDispatcher $eventDispatcher\n     */\n    public function onBeforeRouteEnter( OnBeforeRouteEnterEvent $event, string $eventClassName, EventDispatcher $eventDispatcher ): void {\n        // Read/modify event data or do some logging\n    }\n\n}\n")),Object(o.b)("h3",{id:"listening-to-an-event"},"Listening to an event"),Object(o.b)("p",null,"Listen to an event by marking the class an EventListener by implement the Interface and marking a method as a listener. Provide the event as argument in the attribute. The event will be passed to the method as an argument."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"declare(strict_types=1);\n\nnamespace Foo\\Listener;\n\nuse Swift\\Events\\Attribute\\ListenTo;\nuse Swift\\Events\\EventListenerInterface;\nuse Swift\\Security\\Authentication\\Events\\AuthenticationTokenCreatedEvent;\nuse Swift\\Security\\Authentication\\Token\\ResetPasswordToken;\n\n/**\n * Class OnAfterAuthentication\n * @package Foo\\Listener\n */\nclass OnAfterAuthentication implements EventListenerInterface {\n\n    /**\n     * Send user a mail with password reset token after creating one\n     *\n     * @param AuthenticationTokenCreatedEvent $event\n     */\n    #[ListenTo(event: AuthenticationTokenCreatedEvent::class)]\n    public function mailOnPasswordTokenCreated( AuthenticationTokenCreatedEvent $event ): void {\n        if ($event->getToken() instanceof ResetPasswordToken) {\n            mail(\n                to: $event->getToken()->getUser()->getEmail(),\n                subject: 'Password reset',\n                message: sprintf('Hi %s, Hereby your password reset token: %s.', $event->getToken()->getUser()->getFullName(), $event->getToken()->getTokenString())\n            );\n        }\n    }\n\n}\n")),Object(o.b)("h2",{id:"how-to-create-your-own-events"},"How to create your own events"),Object(o.b)("p",null,"Events are classes which can be dispatched using the EventDispatcher. You can easily create your own like the example."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"declare(strict_types=1);\n\nnamespace Swift\\Security\\Authentication\\Events;\n\n\nuse Swift\\Events\\AbstractEvent;\nuse Swift\\Security\\Authentication\\Token\\TokenInterface;\n\n/**\n * Class AuthenticationTokenCreatedEvent\n * @package Swift\\Security\\Authentication\\Events\n */\nclass AuthenticationTokenCreatedEvent extends AbstractEvent {\n\n    protected static string $eventDescription = 'Authentication token has been created';\n    protected static string $eventLongDescription = '';\n\n    /**\n     * AuthenticationTokenCreatedEvent constructor.\n     *\n     * @param TokenInterface $token\n     */\n    public function __construct(\n        private TokenInterface $token,\n    ) {\n    }\n\n    /**\n     * @return TokenInterface\n     */\n    public function getToken(): TokenInterface {\n        return $this->token;\n    }\n\n    /**\n     * @param TokenInterface $token\n     */\n    public function setToken( TokenInterface $token ): void {\n        $this->token = $token;\n    }\n\n}\n")),Object(o.b)("h2",{id:"dispatching-events"},"Dispatching events"),Object(o.b)("p",null,"Events are dispatched using the EventDispatcher. You will need to inject the EventDispatcher (",Object(o.b)("inlineCode",{parentName:"p"},"Swift\\Events\\EventDispatcher"),") into your class."),Object(o.b)("p",null,"Below an example from the Authentication Manager dispatching an event for the created token."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"// Create authenticated token\n$token = $authenticator->createAuthenticatedToken( $passport );\n$token = $this->eventDispatcher->dispatch( new AuthenticationTokenCreatedEvent( $token ) )->getToken();\n")),Object(o.b)("h2",{id:"default-system-events"},"Default system events"),Object(o.b)("p",null,"All events and their description can be listed by running the command ",Object(o.b)("inlineCode",{parentName:"p"},"php bin/console events:list:all"),". This will result in something as such."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"$ php bin/console events:list:all\n ---------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------------\n  event                                                                  description\n ---------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------------\n  Foo\\Event\\OnBeforeFooEvent                                             Foo example event\n\n  Swift\\HttpFoundation\\Event\\BeforeResponseEvent                         Before response is send\n\n  Swift\\Kernel\\Event\\KernelOnBeforeShutdown                              Before Kernel is terminated after sending response\n\n  Swift\\Kernel\\Event\\KernelRequestEvent                                  Entry into Kernel, before routing and authentication has started\n\n  Swift\\Logging\\Event\\OnBeforeLoggerHandlersEvent                        On Logger construction. Optionally add or remove Logger Handlers\n\n  Swift\\Model\\Events\\EntityOnFieldSerializeEvent                         Before entity serializes field\n\n  Swift\\Model\\Events\\EntityOnFieldUnSerializeEvent                       Before entity deserializes field\n\n  Swift\\Router\\Event\\OnBeforeRouteEnterEvent                             Route is matched, but not the Controller has not been called yet\n\n  Swift\\Router\\Event\\OnBeforeRoutesCompileEvent                          Routes have been collected from Controller, but have not been Compiled yet. Add, modify or remove routes\n  \n  Swift\\Security\\Authentication\\Events\\AuthenticationFailedEvent         Authentication has failed. This could be due to an error or access could be denied\n\n  Swift\\Security\\Authentication\\Events\\AuthenticationFinishedEvent       Authentication process is completed\n\n  Swift\\Security\\Authentication\\Events\\AuthenticationSuccessEvent        A user or client has successfully authenticated against the application\n\n  Swift\\Security\\Authentication\\Events\\AuthenticationTokenCreatedEvent   Authentication token has been created\n\n  Swift\\Security\\Authentication\\Events\\CheckPassportEvent                Passport has been created. Run any validations against passport or add data to passport\n ---------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------------\n")))}l.isMDXComponent=!0}}]);