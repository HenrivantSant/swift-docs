(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{117:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return s}));var o=t(3),i=t(7),a=(t(0),t(141)),r={title:"Configuration"},c={unversionedId:"configuration",id:"configuration",isDocsHomePage:!1,title:"Configuration",description:"The system uses Yaml files for configuration.",source:"@site/docs/configuration.md",slug:"/configuration",permalink:"/swift-docs/docs/configuration",editUrl:"https://github.com/SwiftAPI/swift-docs/tree/main/docs/configuration.md",version:"current",sidebar:"docs",previous:{title:"Command line interface",permalink:"/swift-docs/docs/command-line-interface"},next:{title:"Introduction",permalink:"/swift-docs/docs/database/introduction"}},l=[{value:"Basic setup",id:"basic-setup",children:[]},{value:"Configuration scopes",id:"configuration-scopes",children:[]},{value:"Defining custom configuration",id:"defining-custom-configuration",children:[]},{value:"Reading the configuration",id:"reading-the-configuration",children:[]},{value:"Writing the configuration",id:"writing-the-configuration",children:[{value:"Writing configuration to the file system",id:"writing-configuration-to-the-file-system",children:[]}]},{value:"Extending the core configuration (Configuration Sub Scopes)",id:"extending-the-core-configuration-configuration-sub-scopes",children:[]}],u={toc:l};function s(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},u,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"The system uses ",Object(a.b)("a",{parentName:"p",href:"https://yaml.org/"},"Yaml")," files for configuration."),Object(a.b)("h2",{id:"basic-setup"},"Basic setup"),Object(a.b)("p",null,"The basic app configuration setup is as below. Place these yaml files in the etc/config/ directory of your project. The configuration comes with four configuration files which are necessary. Security (security.yaml), Runtime (runtime.yaml) will be preset for you and you don't need to change anything here if there's no need."),Object(a.b)("h4",{id:"appyaml"},"app.yaml"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"app:\n  # App name\n  name: Foo Bar App\n  # App mode (either develop or production)\n  mode: develop\n  # Enable/disable debug mode\n  debug: true\n  # Allow cross origin requests (returns 200 response for OPTIONS Request if no Route is matched)\n  allow_cors: true\n  # Default application timezone\n  timezone: Europe/Amsterdam\n\nrouting:\n  # Base url used in route matching. This is also useful on sub domains\n  baseurl: foo.bar.com\n\ngraphql:\n  # Enable/disable graphql \n  enabled: true\n  # Enable/disable introspection for graphql\n  enable_introspection: true\n\nlogging:\n  # Enable/disable mails for logger\n  enable_mail: true\n  # Mail from address\n  logging_mail_from: log@foo-bar.com\n  # Mail to address\n  logging_mail_to: log@foo-bar.com\n")),Object(a.b)("h4",{id:"databaseyaml"},"database.yaml"),Object(a.b)("p",null,"For more on the actual working of this, see the Database component."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"connection:\n  driver: mysqli\n  host: localhost\n  username: root\n  password: ''\n  database: foo_bar\n  port: 3306\n  prefix: 4593g_\n")),Object(a.b)("h4",{id:"securityyaml"},"security.yaml"),Object(a.b)("p",null,"For more on the actual working of this, see the Security component."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"enable_firewalls: true\n\nfirewalls:\n  main:\n    # limit login attempts, defaults to 5 per minute. Set to 0 to disable throttling\n    login_throttling:\n      max_attempts: 5\n\nrole_hierarchy:\n  ROLE_GUEST:\n  ROLE_USER:\n  ROLE_CLIENT: ['ROLE_USERS_LIST']\n  ROLE_ADMIN: ['ROLE_USERS_LIST']\n  ROLE_SUPER_ADMIN: ['ROLE_ADMIN']\n\naccess_decision_manager:\n  strategy: Swift\\Security\\Authorization\\Strategy\\AffirmativeDecisionStrategy\n  allow_if_all_abstain: false\n\naccess_control:\n\ngraphql_access_control:\n")),Object(a.b)("h4",{id:"runtimeyaml"},"runtime.yaml"),Object(a.b)("p",null,"For more on the actual working of this, see the Runtime component."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"runtime:\n  enabled: true\ncoroutines:\n  enabled: true\n  run_in_background: true\ncron:\n  enabled: true\n  run_in_background: true\nfile_watcher:\n  enabled: true\n  watch: [app, etc/config]\n  extensions: [php, yaml]\n  ignore: [tests]\nwebsocket:\n  port: 8000\n")),Object(a.b)("h2",{id:"configuration-scopes"},"Configuration scopes"),Object(a.b)("p",null,"To organize configuration, this is split in into different categories called 'scopes'. "),Object(a.b)("p",null,"By default, there are three of those:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"app (etc/config/app.yaml)"),Object(a.b)("li",{parentName:"ul"},"database (etc/config/database.yaml)"),Object(a.b)("li",{parentName:"ul"},"security (etc/config/security.yaml)")),Object(a.b)("p",null,"All three scopes have their own drivers, but they're all available through the generic Configuration ",Object(a.b)("inlineCode",{parentName:"p"},"Swift\\Configuration\\ConfigurationInterface"),"."),Object(a.b)("h2",{id:"defining-custom-configuration"},"Defining custom configuration"),Object(a.b)("p",null,"It is highly likely that you might have the need for custom/additional configuration. This is easily possible. Swift checks the app directory for a config.yaml file. If it is present use it import app configuration files. See the example below.  "),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"app/config.yaml")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"imports:\n  - { resource: app/Foo/config.yaml }\n")),Object(a.b)("p",null,"Now let's add some configuration in there.  "),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"app/Foo/config.yaml")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yaml"},"foo:\n    bar: example\n    lorem: ipsum\n")),Object(a.b)("h2",{id:"reading-the-configuration"},"Reading the configuration"),Object(a.b)("p",null,"To read the configuration you will have to inject the ",Object(a.b)("inlineCode",{parentName:"p"},"Swift\\Configuration\\Configuration")," class (or ",Object(a.b)("inlineCode",{parentName:"p"},"Swift\\Configuration\\ConfigurationInterface $configuration"),"). Simply calling the 'get' method is enough. The first argument is the name of the setting and the second one is the scope. Reading the app configuration uses the 'app' as scope."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"// Get foo bar value from the example above\n$fooBarConfigurationValue = $this->configuration->get('foo.bar', 'app/Foo');\n\n// Check if app is in debug mode\n$isDebug = $this->configuration->get('app.debug', 'app');\n\n// Database username\n$databaseUsername = $this->configuration->get('connection.username', 'database');\n")),Object(a.b)("h2",{id:"writing-the-configuration"},"Writing the configuration"),Object(a.b)("p",null,"Writing the configuration works in the exact same matter. Note that is not possible to write to non-existing settings. Make sure the setting you're trying to write is defined on beforehand."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"// Write to the previous foo.bar example\n$this->configuration->set('foo.bar', 'writing example', 'app/Foo');\n")),Object(a.b)("h3",{id:"writing-configuration-to-the-file-system"},"Writing configuration to the file system"),Object(a.b)("p",null,"Note that writing the configuration as above will not write the configuration to the file system right away. This is because the configuration is cached in memory. Only when the Kernel is shutting down, the configuration be written to the file system. Therefore, it's important to correctly terminate the application."),Object(a.b)("h2",{id:"extending-the-core-configuration-configuration-sub-scopes"},"Extending the core configuration (Configuration Sub Scopes)"),Object(a.b)("p",null,"It is possible to extend the core configuration. This is done by creating a new configuration scope. The scope name is the name of the configuration sub scope. The configuration sub scope is a sub scope of the core configuration. This is useful when extending the core functionality. To create a new configuration sub scope, you need to create a new class that implements the ",Object(a.b)("inlineCode",{parentName:"p"},"Swift\\Configuration\\ConfigurationSubScopeInterface"),". See the example below. This way we can inject additional configuration into the existing core configuration."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace Swift\\GraphQl\\Configuration;\n\n\nclass AppConfiguration implements \\Swift\\Configuration\\ConfigurationSubScopeInterface {\n    \n    public function getScope(): array {\n        return [ 'app', 'root' ];\n    }\n    \n    public function getConfigTreeBuilder( \\Symfony\\Component\\Config\\Definition\\Builder\\NodeBuilder $builder ):  \\Symfony\\Component\\Config\\Definition\\Builder\\NodeBuilder {\n        $builder\n            ->arrayNode('graphql')\n                ->children()\n                    ->booleanNode('enabled')->defaultTrue()->end()\n                    ->booleanNode('enable_introspection')->defaultTrue()->end()\n                ->end()\n            ->end();\n        \n        return $builder;\n    }\n    \n    public function getDefaultValues(): array {\n        return [\n            'graphql' => [\n                'enabled'              => true,\n                'enable_introspection' => true,\n            ],\n        ];\n    }\n    \n}\n")))}s.isMDXComponent=!0},141:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return g}));var o=t(0),i=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var u=i.a.createContext({}),s=function(e){var n=i.a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},p=function(e){var n=s(e.components);return i.a.createElement(u.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},b=i.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,r=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(t),b=o,g=p["".concat(r,".").concat(b)]||p[b]||f[b]||a;return t?i.a.createElement(g,c(c({ref:n},u),{},{components:t})):i.a.createElement(g,c({ref:n},u))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,r=new Array(a);r[0]=b;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:o,r[1]=c;for(var u=2;u<a;u++)r[u]=t[u];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);