(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{135:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),i=n(7),o=(n(0),n(144)),a={title:"Relay"},l={unversionedId:"graphql/relay",id:"graphql/relay",isDocsHomePage:!1,title:"Relay",description:"It is recommended to follow the Relay Server Specs in the schema. All default Swift endpoint will comply with this spec out of the box. There's some useful abstracts and interfaces to help you on the way.",source:"@site/docs/graphql/relay.md",slug:"/graphql/relay",permalink:"/swift-docs/docs/graphql/relay",editUrl:"https://github.com/SwiftAPI/swift-docs/tree/main/docs/graphql/relay.md",version:"current",sidebar:"docs",previous:{title:"Tools",permalink:"/swift-docs/docs/graphql/tools"},next:{title:"Security",permalink:"/swift-docs/docs/graphql/security"}},c=[{value:"Usage",id:"usage",children:[{value:"1. Create a single type",id:"1-create-a-single-type",children:[]},{value:"2. Create a connection type",id:"2-create-a-connection-type",children:[]},{value:"3. Add the connection to the query",id:"3-add-the-connection-to-the-query",children:[]}]},{value:"Full example",id:"full-example",children:[]},{value:"Advanced",id:"advanced",children:[]}],s={toc:c};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"It is recommended to follow the ",Object(o.b)("a",{parentName:"p",href:"https://relay.dev/docs/guides/graphql-server-specification/"},"Relay Server Specs")," in the schema. All default Swift endpoint will comply with this spec out of the box. There's some useful abstracts and interfaces to help you on the way."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Currently, Relay only support Collections of data queried from the database.")),Object(o.b)("h2",{id:"usage"},"Usage"),Object(o.b)("p",null,"To create a connection there's three basic steps."),Object(o.b)("h3",{id:"1-create-a-single-type"},"1. Create a single type"),Object(o.b)("p",null,"This is the list of types that will be returned by the query. For example a list (connection) of Movie's."),Object(o.b)("p",null,"This type should implement the ",Object(o.b)("inlineCode",{parentName:"p"},"Node")," interface."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"When the Node Interface is queried by id, the fieldResolver will be called with the ID param. The fieldResolver should return the entity with the given ID. If the ID not passed as an arg, you should just return the $objectValue.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"$type = Builder::objectType( 'Foo' )\n                   ->addInterface( Relay::NODE, static fn() => Registry::$typeMap[ Relay::NODE ] )\n                   ->addField(\n                       'id',\n                       Builder::fieldType(\n                           'id',\n                           static fn() => Builder::nonNull( Type::id() )\n                       )->buildType(),\n                   )\n                   ->addField(\n                       'title',\n                       Builder::fieldType(\n                           'title',\n                           static fn() => Builder::nonNull( Type::string() )\n                       )->buildType(),\n                   )\n                   ->addField(\n                       'description',\n                       Builder::fieldType(\n                           'description',\n                           static fn() => Builder::nonNull( Type::string() )\n                       )->buildType(),\n                   )\n                   ->setFieldResolver( function ( $objectValue, array $args, $context, ResolveInfo $info ) {\n                       // Resolve Node Interface query\n                       if ( ! $objectValue && ! empty( $args[ 'id' ] ) ) {\n                           return $this->entityManager->findOne( Movie::class, $args[ 'id' ] );\n                       }\n        \n                       return $objectValue;\n                   } );\n    \n$registry->objectType( $type );\n")),Object(o.b)("h3",{id:"2-create-a-connection-type"},"2. Create a connection type"),Object(o.b)("p",null,"This is the type that will be returned by the query, the connection. This is fairly easy as the Relay Middleware will do most of the work for you. All you need to do create a connection and refer it to the type you created in step 1."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"$connection = Builder::connectionType( 'FooConnection', $type );   \n$registry->objectType( $connection );\n")),Object(o.b)("h3",{id:"3-add-the-connection-to-the-query"},"3. Add the connection to the query"),Object(o.b)("p",null,"This is the last step. You need to add the connection to the query. So it actually becomes available. "),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Note that Relay expects a ",Object(o.b)("inlineCode",{parentName:"p"},"Swift\\Orm\\Dbal\\ResultCollectionInterface")," as the result of the query. This is always the return value of any findMany query on the ORMs EntityManager. However, you can also use any other implementation of the interface.")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"$registry->extendType( 'Query', function ( ObjectBuilder $builder ) use ( $connection ) {\n    $query = Builder::fieldType( 'FooList', static fn() => Registry::$typeMap[ $connection->getName() ] )\n                    ->setResolver( function ( $objectValue, $args, $context, ResolveInfo $info ) {\n                        // Resolve connection\n                        return $this->entityManager->findMany( Movie::class );\n                    } );\n    \n    $builder->addField( 'FooList', $query->buildType() );\n    \n    return $builder;\n} );\n")),Object(o.b)("h2",{id:"full-example"},"Full example"),Object(o.b)("p",null,"The full example below as generators looks like this:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-php"},"<?php declare( strict_types=1 );\n\nnamespace Foo\\GraphQl\\Schema\\Generator;\n\nuse Foo\\Repository\\Movie;\nuse GraphQL\\Type\\Definition\\ResolveInfo;\nuse GraphQL\\Type\\Definition\\Type;\nuse Swift\\DependencyInjection\\Attributes\\Autowire;\nuse Swift\\GraphQl\\Relay\\Relay;\nuse Swift\\GraphQl\\Schema\\Builder\\Builder;\nuse Swift\\GraphQl\\Schema\\Builder\\ObjectBuilder;\nuse Swift\\GraphQl\\Schema\\Registry;\nuse Swift\\Orm\\EntityManagerInterface;\n\n#[Autowire]\nclass DemoGenerator implements \\Swift\\GraphQl\\Schema\\Generator\\GeneratorInterface {\n    \n    public function __construct(\n        protected readonly EntityManagerInterface $entityManager,\n    ) {\n    }\n    \n    public function generate( \\Swift\\GraphQl\\Schema\\Registry $registry ): \\Swift\\GraphQl\\Schema\\Registry {\n        $type = $this->genType( $registry );\n        \n        $connection = Builder::connectionType( 'FooConnection', $type );\n        $registry->objectType( $connection );\n        \n        $registry->extendType( 'Query', function ( ObjectBuilder $builder ) use ( $connection ) {\n            $query = Builder::fieldType( 'FooList', static fn() => Registry::$typeMap[ $connection->getName() ] )\n                            ->setResolver( function ( $objectValue, $args, $context, ResolveInfo $info ) {\n                                // Resolve connection\n                                return $this->entityManager->findMany( Movie::class );\n                            } );\n            \n            $builder->addField( 'FooList', $query->buildType() );\n            \n            return $builder;\n        } );\n        \n        return $registry;\n    }\n    \n    public function genType( \\Swift\\GraphQl\\Schema\\Registry $registry ): ObjectBuilder {\n        $type = Builder::objectType( 'Foo' )\n                       ->addInterface( Relay::NODE, static fn() => Registry::$typeMap[ Relay::NODE ] )\n                       ->addField(\n                           'id',\n                           Builder::fieldType(\n                               'id',\n                               static fn() => Builder::nonNull( Type::id() )\n                           )->buildType(),\n                       )\n                       ->addField(\n                           'title',\n                           Builder::fieldType(\n                               'title',\n                               static fn() => Builder::nonNull( Type::string() )\n                           )->buildType(),\n                       )\n                       ->addField(\n                           'description',\n                           Builder::fieldType(\n                               'description',\n                               static fn() => Builder::nonNull( Type::string() )\n                           )->buildType(),\n                       )\n                       ->setFieldResolver( function ( $objectValue, array $args, $context, ResolveInfo $info ) {\n                           // Resolve Node Interface query\n                           if ( ! $objectValue && ! empty( $args[ 'id' ] ) ) {\n                               return $this->entityManager->findOne( Movie::class, $args[ 'id' ] );\n                           }\n            \n                           return $objectValue;\n                       } );\n        \n        $registry->objectType( $type );\n        \n        return $type;\n    }\n    \n}\n")),Object(o.b)("h2",{id:"advanced"},"Advanced"),Object(o.b)("p",null,"For a more advanced example: see the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/SwiftAPI/swift/blob/main/src/Orm/GraphQl/Schema/Generator/OrmGenerator.php"},"ORM Generator"),"."))}u.isMDXComponent=!0},144:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b}));var r=n(0),i=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),u=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},y=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,a=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=u(n),y=r,b=p["".concat(a,".").concat(y)]||p[y]||d[y]||o;return n?i.a.createElement(b,l(l({ref:t},s),{},{components:n})):i.a.createElement(b,l({ref:t},s))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=y;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var s=2;s<o;s++)a[s]=n[s];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,n)}y.displayName="MDXCreateElement"}}]);